{% comment %}newsletter-form.liquid{% endcomment %}
<section class="home-email">
  <div class="email-container">
    <div class="email-title-container">
      <h2 class="email-header">{{ section.settings.header_title }}</h2>
    </div>

    <div class="email-content-container">
      <p>{{ section.settings.sub_text }}</p>
      <div id="messageContainer" class="message-container"></div>

      {%- form 'customer', id: 'newsletterForm', class: 'newsletter-form' -%}
        <input type="hidden" name="contact[tags]" value="newsletter">
        <input type="email"
          name="contact[email]"
          id="emailInput"
          placeholder="Email Address"
          required
          class="email-input">
        <button type="submit" class="email-submit-button">{{ section.settings.button_text }}</button>
      {%- endform -%}
    </div>
  </div>
</section>

<style>
.message-container { padding: 10px 0; display: none; }
.success-message { color: #155724; background: #d4edda; padding: 10px; border-radius: 4px; }
.error-message { color: #721c24; background: #f8d7da; padding: 10px; border-radius: 4px; }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('newsletterForm');
  const messageContainer = document.getElementById('messageContainer');
  const formSection = document.querySelector('.home-email');
  let formPosition = sessionStorage.getItem('formPosition');

  if (formPosition) {
    window.scrollTo(0, parseInt(formPosition));
    sessionStorage.removeItem('formPosition');
  }

  form.addEventListener('submit', function() {
    sessionStorage.setItem('formPosition', window.pageYOffset);
  });

  if (window.location.search.includes('customer_posted=true')) {
    form.style.display = 'none';
    messageContainer.innerHTML = '<div class="success-message">Thanks for subscribing!</div>';
    messageContainer.style.display = 'block';
    history.replaceState({}, '', window.location.pathname);
  }
});
</script>

{% schema %}
{
  "name": "Email Sub Section",
  "settings": [
    {
      "type": "text",
      "id": "header_title",
      "label": "Header Title",
      "default": "Be the First to Know"
    },
    {
      "type": "text",
      "id": "sub_text",
      "label": "Subheader Text",
      "default": "Be the first to know when we launch."
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text",
      "default": "Join Now"
    }
  ],
  "presets": [
    {
      "name": "Email Sub Section"
    }
  ]
}
{% endschema %}